<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Simulator - Innovative Beauty Group</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header img {
            max-width: 200px;
            height: auto;
            margin-bottom: 15px;
            background: white;
            padding: 10px;
            border-radius: 10px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .content {
            padding: 25px;
        }

        .section {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .section-title {
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        button {
            background: #667eea;
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-add {
            margin-top: 15px;
            width: 100%;
        }
        
        .btn-export {
            background: #27ae60;
            margin-top: 15px;
            width: 100%;
        }
        
        .btn-export:hover {
            background: #229954;
        }

        .btn-remove {
            background: #e74c3c;
            padding: 8px 15px;
            font-size: 14px;
        }

        .btn-remove:hover {
            background: #c0392b;
        }

        .components-list {
            margin-top: 20px;
        }

        .component-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 2px solid #e0e0e0;
            position: relative;
        }

        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .component-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #667eea;
        }

        .component-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .component-detail {
            font-size: 0.9em;
            color: #666;
        }

        .component-detail strong {
            color: #333;
        }

        .summary-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 1.1em;
        }

        .summary-row:last-child {
            border-bottom: none;
            font-size: 1.5em;
            font-weight: 700;
            margin-top: 10px;
            padding-top: 20px;
            border-top: 2px solid white;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
            font-style: italic;
        }

        .info-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://innovativebeautygroup.com/wp-content/uploads/2025/10/logo.webp" alt="Innovative Beauty Group Logo">
            <h1>Innovative Beauty Group</h1>
            <p>DDP Price Calculator</p>
        </div>

        <div class="content">
            <!-- Product Name Section -->
            <div class="section">
                <h2 class="section-title">Product Information</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName">Customer Name *</label>
                        <input type="text" id="customerName" placeholder="Enter customer name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="productName">Finished Product Name *</label>
                        <input type="text" id="productName" placeholder="Enter product name">
                    </div>
                    <div class="form-group">
                        <label for="freightOutCost">Freight Out Cost ($)</label>
                        <input type="number" id="freightOutCost" step="0.01" min="0" value="0" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="marginPercent">Expected Margin (%) *</label>
                        <input type="number" id="marginPercent" step="0.01" min="0" value="0" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="reciprocalMarginPercent">Reciprocal Tariff Margin (%)</label>
                        <input type="number" id="reciprocalMarginPercent" step="0.01" min="0" value="10" placeholder="10.00">
                    </div>
                </div>
            </div>

            <!-- Component Input Section -->
            <div class="section">
                <h2 class="section-title">Add Component</h2>
                <form id="componentForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="componentName">Component Name *</label>
                            <input type="text" id="componentName" required placeholder="Enter component name">
                        </div>

                        <div class="form-group">
                            <label for="componentType">Component Type *</label>
                            <select id="componentType" required>
                                <option value="Primary Pack">Primary Pack</option>
                                <option value="Secondary Packaging">Secondary Packaging</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="vendorName">Vendor/Filler Name</label>
                            <input type="text" id="vendorName" placeholder="Enter vendor/filler name">
                        </div>

                        <div class="form-group">
                            <label for="sourceCountry">Source Country *</label>
                            <select id="sourceCountry" required>
                                <option value="USA">USA</option>
                                <option value="China">China</option>
                                <option value="India">India</option>
                                <option value="Mexico">Mexico</option>
                                <option value="Canada">Canada</option>
                                <option value="Vietnam">Vietnam</option>
                                <option value="Thailand">Thailand</option>
                                <option value="South Korea">South Korea</option>
                                <option value="Japan">Japan</option>
                                <option value="Germany">Germany</option>
                                <option value="Italy">Italy</option>
                                <option value="France">France</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="componentCost">Component Cost ($) *</label>
                            <input type="number" id="componentCost" step="0.01" min="0" required placeholder="0.00">
                        </div>

                        <div class="form-group">
                            <label for="freightCost">Freight Cost ($) *</label>
                            <input type="number" id="freightCost" step="0.01" min="0" required placeholder="0.00">
                        </div>

                        <div class="form-group">
                            <label for="bulkAssemblyScrap">Bulk/Assembly/Scrap Cost ($) *</label>
                            <input type="number" id="bulkAssemblyScrap" step="0.01" min="0" required placeholder="0.00">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="dutiesPercent">Duties (% of Component Cost)</label>
                            <input type="number" id="dutiesPercent" step="0.01" min="0" value="0" placeholder="0.00">
                            <p class="info-text">Applied to component cost only</p>
                        </div>

                        <div class="form-group">
                            <label for="standardTariffPercent">Standard Tariff (% of Component Cost)</label>
                            <input type="number" id="standardTariffPercent" step="0.01" min="0" value="0" placeholder="0.00">
                            <p class="info-text">Applied to component cost only</p>
                        </div>

                        <div class="form-group">
                            <label for="reciprocalTariffPercent">Reciprocal Tariff (% of Component Cost)</label>
                            <input type="number" id="reciprocalTariffPercent" step="0.01" min="0" value="0" placeholder="0.00">
                            <p class="info-text">Applied to component cost only</p>
                        </div>
                    </div>

                    <button type="submit" class="btn-add">Add Component</button>
                </form>
            </div>

            <!-- Components List Section -->
            <div class="section">
                <h2 class="section-title">Components Added</h2>
                <div id="componentsList" class="components-list">
                    <div class="empty-state">No components added yet. Add a component above to get started.</div>
                </div>
            </div>

            <!-- Price Summary Section -->
            <div class="summary-section">
                <h2 class="section-title" style="color: white; margin-bottom: 20px;">Price Summary</h2>
                <div class="summary-row">
                    <span>Primary Pack:</span>
                    <span id="primaryPackTotal">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Secondary Pack:</span>
                    <span id="secondaryPackTotal">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Duties:</span>
                    <span id="totalDutiesCost">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Standard Tariff:</span>
                    <span id="totalStandardTariff">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Reciprocal Tariff:</span>
                    <span id="totalReciprocalTariff">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Freight Out:</span>
                    <span id="freightOutTotal">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Margin (Product) (<span id="marginPercentDisplay">0</span>%):</span>
                    <span id="marginAmount">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Margin (Reciprocal Tariff) (<span id="reciprocalMarginPercentDisplay">10</span>%):</span>
                    <span id="reciprocalMarginAmount">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Total Price:</span>
                    <span id="ddpPrice">$0.00</span>
                </div>
                <button id="exportPdfBtn" class="btn-export">Export to PDF</button>
            </div>
        </div>
    </div>

    <!-- Include jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script>
        // Application State
        let components = [];
        let nextComponentId = 1;

        // DOM Elements
        const componentForm = document.getElementById('componentForm');
        const componentsList = document.getElementById('componentsList');
        const marginPercentInput = document.getElementById('marginPercent');
        const reciprocalMarginPercentInput = document.getElementById('reciprocalMarginPercent');
        const freightOutCostInput = document.getElementById('freightOutCost');
        const exportPdfBtn = document.getElementById('exportPdfBtn');

        // Event Listeners
        componentForm.addEventListener('submit', handleAddComponent);
        marginPercentInput.addEventListener('input', updateSummary);
        reciprocalMarginPercentInput.addEventListener('input', updateSummary);
        freightOutCostInput.addEventListener('input', updateSummary);
        componentsList.addEventListener('click', handleRemoveClick);
        exportPdfBtn.addEventListener('click', exportToPdf);

        // Add Component Handler
        function handleAddComponent(e) {
            e.preventDefault();

            const nameValue = document.getElementById('componentName').value.trim();
            
            // Validate component name
            if (!nameValue || nameValue.length === 0) {
                alert('Please enter a component name.');
                return;
            }
            
            if (nameValue.length > 100) {
                alert('Component name is too long. Please limit to 100 characters.');
                return;
            }

            const componentCost = parseFloat(document.getElementById('componentCost').value) || 0;
            const dutiesPercent = parseFloat(document.getElementById('dutiesPercent').value) || 0;
            const standardTariffPercent = parseFloat(document.getElementById('standardTariffPercent').value) || 0;
            const reciprocalTariffPercent = parseFloat(document.getElementById('reciprocalTariffPercent').value) || 0;
            
            const dutiesCost = (componentCost * dutiesPercent) / 100;
            const standardTariffCost = (componentCost * standardTariffPercent) / 100;
            const reciprocalTariffCost = (componentCost * reciprocalTariffPercent) / 100;

            const component = {
                id: nextComponentId++,
                name: nameValue,
                type: document.getElementById('componentType').value,
                vendorName: document.getElementById('vendorName').value.trim(),
                sourceCountry: document.getElementById('sourceCountry').value,
                componentCost: componentCost,
                freightCost: parseFloat(document.getElementById('freightCost').value) || 0,
                bulkAssemblyScrap: parseFloat(document.getElementById('bulkAssemblyScrap').value) || 0,
                dutiesPercent: dutiesPercent,
                dutiesCost: dutiesCost,
                standardTariffPercent: standardTariffPercent,
                standardTariffCost: standardTariffCost,
                reciprocalTariffPercent: reciprocalTariffPercent,
                reciprocalTariffCost: reciprocalTariffCost
            };

            components.push(component);
            componentForm.reset();
            // Reset reciprocal margin to default
            document.getElementById('reciprocalMarginPercent').value = 10;
            renderComponents();
            updateSummary();
        }

        // Remove Component Handler
        function handleRemoveClick(e) {
            if (e.target.classList.contains('btn-remove')) {
                const id = parseInt(e.target.dataset.componentId, 10);
                
                // Validate that we got a valid ID
                if (isNaN(id)) {
                    console.error('Invalid component ID');
                    return;
                }
                
                components = components.filter(c => c.id !== id);
                renderComponents();
                updateSummary();
            }
        }

        // Render Components List
        function renderComponents() {
            if (components.length === 0) {
                componentsList.innerHTML = '<div class="empty-state">No components added yet. Add a component above to get started.</div>';
                return;
            }

            // Clear existing components
            componentsList.innerHTML = '';

            // Create and append each component using DOM manipulation for better security
            components.forEach(component => {
                const componentItem = document.createElement('div');
                componentItem.className = 'component-item';

                const componentHeader = document.createElement('div');
                componentHeader.className = 'component-header';

                const componentNameDiv = document.createElement('div');
                componentNameDiv.className = 'component-name';
                componentNameDiv.textContent = component.name + ' (from ' + component.sourceCountry + ')'; // Safe from XSS

                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn-remove';
                removeBtn.dataset.componentId = component.id;
                removeBtn.textContent = 'Remove';

                componentHeader.appendChild(componentNameDiv);
                componentHeader.appendChild(removeBtn);

                const componentDetails = document.createElement('div');
                componentDetails.className = 'component-details';

                // Helper function to create detail div
                const createDetail = (label, value) => {
                    const detailDiv = document.createElement('div');
                    detailDiv.className = 'component-detail';
                    const strong = document.createElement('strong');
                    strong.textContent = label + ':';
                    detailDiv.appendChild(strong);
                    detailDiv.appendChild(document.createTextNode(' ' + value));
                    return detailDiv;
                };

                const createDetailWithPercent = (label, percent, value) => {
                    const detailDiv = document.createElement('div');
                    detailDiv.className = 'component-detail';
                    const strong = document.createElement('strong');
                    strong.textContent = label + ':';
                    detailDiv.appendChild(strong);
                    detailDiv.appendChild(document.createTextNode(' ' + percent.toFixed(2) + '% ($' + value.toFixed(2) + ')'));
                    return detailDiv;
                };

                componentDetails.appendChild(createDetail('Type', component.type));
                if (component.vendorName) {
                    componentDetails.appendChild(createDetail('Vendor/Filler', component.vendorName));
                }
                componentDetails.appendChild(createDetail('Component Cost', '$' + component.componentCost.toFixed(2)));
                componentDetails.appendChild(createDetail('Freight Cost', '$' + component.freightCost.toFixed(2)));
                componentDetails.appendChild(createDetail('Bulk/Assembly/Scrap', '$' + component.bulkAssemblyScrap.toFixed(2)));
                componentDetails.appendChild(createDetailWithPercent('Duties', component.dutiesPercent, component.dutiesCost));
                componentDetails.appendChild(createDetailWithPercent('Standard Tariff', component.standardTariffPercent, component.standardTariffCost));
                componentDetails.appendChild(createDetailWithPercent('Reciprocal Tariff', component.reciprocalTariffPercent, component.reciprocalTariffCost));
                componentDetails.appendChild(createDetail('Total', '$' + 
                    (component.componentCost + component.freightCost + component.bulkAssemblyScrap + 
                     component.dutiesCost + component.standardTariffCost + component.reciprocalTariffCost).toFixed(2)));

                componentItem.appendChild(componentHeader);
                componentItem.appendChild(componentDetails);
                componentsList.appendChild(componentItem);
            });
        }

        // Update Price Summary
        function updateSummary() {
            // Separate components by type
            const primaryPackComponents = components.filter(c => c.type === 'Primary Pack');
            const secondaryPackComponents = components.filter(c => c.type === 'Secondary Packaging');
            
            // Calculate Primary Pack total (all costs including freight, bulk, etc.)
            const primaryPackTotal = primaryPackComponents.reduce((sum, c) => 
                sum + c.componentCost + c.freightCost + c.bulkAssemblyScrap, 0);
            
            // Calculate Secondary Pack total (all costs including freight, bulk, etc.)
            const secondaryPackTotal = secondaryPackComponents.reduce((sum, c) => 
                sum + c.componentCost + c.freightCost + c.bulkAssemblyScrap, 0);
            
            // Calculate total duties (from all components)
            const totalDutiesCost = components.reduce((sum, c) => sum + c.dutiesCost, 0);
            
            // Calculate total standard tariff (from all components)
            const totalStandardTariff = components.reduce((sum, c) => sum + c.standardTariffCost, 0);
            
            // Calculate total reciprocal tariff (from all components)
            const totalReciprocalTariff = components.reduce((sum, c) => sum + c.reciprocalTariffCost, 0);
            
            // Get Freight Out cost (product level)
            const freightOutCost = parseFloat(freightOutCostInput.value) || 0;
            
            // Calculate subtotal before margins
            const subtotal = primaryPackTotal + secondaryPackTotal + totalDutiesCost + 
                           totalStandardTariff + totalReciprocalTariff + freightOutCost;

            // Calculate margin (product) - applied to subtotal
            const marginPercent = parseFloat(marginPercentInput.value) || 0;
            const marginAmount = (subtotal * marginPercent) / 100;
            
            // Calculate margin for reciprocal tariff separately
            const reciprocalMarginPercent = parseFloat(reciprocalMarginPercentInput.value) || 0;
            const reciprocalMarginAmount = (totalReciprocalTariff * reciprocalMarginPercent) / 100;
            
            // Calculate total price
            const totalPrice = subtotal + marginAmount + reciprocalMarginAmount;

            // Update DOM
            document.getElementById('primaryPackTotal').textContent = `$${primaryPackTotal.toFixed(2)}`;
            document.getElementById('secondaryPackTotal').textContent = `$${secondaryPackTotal.toFixed(2)}`;
            document.getElementById('totalDutiesCost').textContent = `$${totalDutiesCost.toFixed(2)}`;
            document.getElementById('totalStandardTariff').textContent = `$${totalStandardTariff.toFixed(2)}`;
            document.getElementById('totalReciprocalTariff').textContent = `$${totalReciprocalTariff.toFixed(2)}`;
            document.getElementById('freightOutTotal').textContent = `$${freightOutCost.toFixed(2)}`;
            document.getElementById('marginPercentDisplay').textContent = marginPercent.toFixed(2);
            document.getElementById('marginAmount').textContent = `$${marginAmount.toFixed(2)}`;
            document.getElementById('reciprocalMarginPercentDisplay').textContent = reciprocalMarginPercent.toFixed(2);
            document.getElementById('reciprocalMarginAmount').textContent = `$${reciprocalMarginAmount.toFixed(2)}`;
            document.getElementById('ddpPrice').textContent = `$${totalPrice.toFixed(2)}`;
        }

        // Export to PDF
        function exportToPdf() {
            if (components.length === 0) {
                alert('Please add at least one component before exporting.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Get product information
            const customerName = document.getElementById('customerName').value.trim() || 'N/A';
            const productName = document.getElementById('productName').value.trim() || 'Untitled Product';
            const freightOutCost = parseFloat(freightOutCostInput.value) || 0;
            const marginPercent = parseFloat(marginPercentInput.value) || 0;
            const reciprocalMarginPercent = parseFloat(reciprocalMarginPercentInput.value) || 0;

            // Add title
            doc.setFontSize(18);
            doc.setTextColor(102, 126, 234);
            doc.text('Innovative Beauty Group', 105, 15, { align: 'center' });
            
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('DDP Price Calculator - Detailed Pricing Breakdown', 105, 25, { align: 'center' });

            // Add product information
            doc.setFontSize(11);
            doc.text('Customer: ' + customerName, 14, 35);
            doc.text('Product: ' + productName, 14, 42);
            doc.text('Date: ' + new Date().toLocaleDateString(), 14, 49);

            // Prepare component data with all details
            const componentData = components.map(c => [
                c.name,
                c.type,
                c.vendorName || 'N/A',
                c.sourceCountry,
                '$' + c.componentCost.toFixed(2),
                '$' + c.freightCost.toFixed(2),
                '$' + c.bulkAssemblyScrap.toFixed(2),
                c.dutiesPercent.toFixed(2) + '%',
                '$' + c.dutiesCost.toFixed(2),
                c.standardTariffPercent.toFixed(2) + '%',
                '$' + c.standardTariffCost.toFixed(2),
                c.reciprocalTariffPercent.toFixed(2) + '%',
                '$' + c.reciprocalTariffCost.toFixed(2),
                '$' + (c.componentCost + c.freightCost + c.bulkAssemblyScrap + 
                       c.dutiesCost + c.standardTariffCost + c.reciprocalTariffCost).toFixed(2)
            ]);

            // Add component table
            doc.autoTable({
                startY: 56,
                head: [['Component', 'Type', 'Vendor', 'Source', 'Comp Cost', 'Freight', 'Bulk/Asm/Scrap', 'Duties %', 'Duties $', 'Std Tariff %', 'Std Tariff $', 'Recip Tariff %', 'Recip Tariff $', 'Total']],
                body: componentData,
                theme: 'striped',
                headStyles: { fillColor: [102, 126, 234], fontSize: 7 },
                styles: { fontSize: 7, cellPadding: 1.5 },
                columnStyles: {
                    0: { cellWidth: 20 },
                    1: { cellWidth: 15 },
                    2: { cellWidth: 15 },
                    3: { cellWidth: 15 },
                    4: { cellWidth: 12 },
                    5: { cellWidth: 12 },
                    6: { cellWidth: 15 },
                    7: { cellWidth: 11 },
                    8: { cellWidth: 11 },
                    9: { cellWidth: 13 },
                    10: { cellWidth: 13 },
                    11: { cellWidth: 14 },
                    12: { cellWidth: 14 },
                    13: { cellWidth: 15 }
                }
            });

            // Calculate summary values
            const primaryPackComponents = components.filter(c => c.type === 'Primary Pack');
            const secondaryPackComponents = components.filter(c => c.type === 'Secondary Packaging');
            
            const primaryPackTotal = primaryPackComponents.reduce((sum, c) => 
                sum + c.componentCost + c.freightCost + c.bulkAssemblyScrap, 0);
            const secondaryPackTotal = secondaryPackComponents.reduce((sum, c) => 
                sum + c.componentCost + c.freightCost + c.bulkAssemblyScrap, 0);
            const totalDutiesCost = components.reduce((sum, c) => sum + c.dutiesCost, 0);
            const totalStandardTariff = components.reduce((sum, c) => sum + c.standardTariffCost, 0);
            const totalReciprocalTariff = components.reduce((sum, c) => sum + c.reciprocalTariffCost, 0);
            
            const subtotal = primaryPackTotal + secondaryPackTotal + totalDutiesCost + 
                           totalStandardTariff + totalReciprocalTariff + freightOutCost;
            const marginAmount = (subtotal * marginPercent) / 100;
            const reciprocalMarginAmount = (totalReciprocalTariff * reciprocalMarginPercent) / 100;
            const totalPrice = subtotal + marginAmount + reciprocalMarginAmount;

            // Add summary table
            const summaryData = [
                ['Primary Pack', '$' + primaryPackTotal.toFixed(2)],
                ['Secondary Pack', '$' + secondaryPackTotal.toFixed(2)],
                ['Duties', '$' + totalDutiesCost.toFixed(2)],
                ['Standard Tariff', '$' + totalStandardTariff.toFixed(2)],
                ['Reciprocal Tariff', '$' + totalReciprocalTariff.toFixed(2)],
                ['Freight Out', '$' + freightOutCost.toFixed(2)],
                ['Margin (Product) (' + marginPercent.toFixed(2) + '%)', '$' + marginAmount.toFixed(2)],
                ['Margin (Reciprocal Tariff) (' + reciprocalMarginPercent.toFixed(2) + '%)', '$' + reciprocalMarginAmount.toFixed(2)],
                ['Total Price', '$' + totalPrice.toFixed(2)]
            ];

            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 10,
                head: [['Price Summary', 'Amount']],
                body: summaryData,
                theme: 'striped',
                headStyles: { fillColor: [102, 126, 234], fontSize: 11 },
                styles: { fontSize: 10 },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 140 },
                    1: { halign: 'right', cellWidth: 42 }
                },
                didParseCell: function(data) {
                    if (data.section === 'body' && data.row.index === summaryData.length - 1) {
                        data.cell.styles.fillColor = [102, 126, 234];
                        data.cell.styles.textColor = [255, 255, 255];
                        data.cell.styles.fontStyle = 'bold';
                        data.cell.styles.fontSize = 12;
                    }
                }
            });

            // Save PDF
            const fileName = productName.replace(/[^a-z0-9]/gi, '_') + '_pricing.pdf';
            doc.save(fileName);
        }

        // Initialize
        updateSummary();
    </script>
</body>
</html>
